<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff</title>
  <link rel="icon" href="images/ico school.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/staff.css">
</head>
<body>
<nav class="navbar" id="navbar">
  <div class="nav-container">
    <div class="nav-logo">
      <img src="images/logo.png" alt="New Cairo STEM School" class="logo">
      <span class="logo-text">New Cairo STEM School</span>
    </div>
    <ul class="nav-menu" id="nav-menu">
      <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
      <li class="nav-item"><a href="About.html" class="nav-link">About</a></li>
      <li class="nav-item"><a href="Academics.html" class="nav-link">Academics & Skills</a></li>
      <li class="nav-item"><a href="Admissions.html" class="nav-link">Admissions</a></li>
      <li class="nav-item"><a href="Acheivments.html" class="nav-link">Students Achievements</a></li>
      <li class="nav-item"><a href="Staff.html" class="nav-link">Staff</a></li>
      <li class="nav-item"><a href="photos.html" class="nav-link">Campus</a></li>
    </ul>
    <div class="hamburger" id="hamburger">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </div>
  </div>
</nav>

<div class="staff-body">
  <h1 class="staff-header">Staff</h1>
  <div id="staff-container">
    <!-- Dynamic staff sections will be generated here -->
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <div class="footer-logo">
          <img src="images/logo.png" alt="New Cairo STEM School" class="footer-logo-img">
          <h3>New Cairo STEM School</h3>
        </div>
        <p>Excellence in Science, Technology, Engineering & Mathematics education, preparing students for a bright future in STEM fields.</p>
      </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="About.html">About</a></li>
                    <li><a href="Academics.html">Academics & Skills</a></li>
                    <li><a href="Admissions.html">Admissions</a></li>
                    <li><a href="Acheivments.html">Students Achievements</a></li>
                    <li><a href="Staff.html">Staff</a></li>
                    <li><a href="photos.html">Campus</a></li>
                </ul>
            </div>
      <div class="footer-section">
        <h4>Contact Info</h4>
        <div class="footer-contact">
          <p><i class="fas fa-map-marker-alt"></i> 
            <a href="https://goo.gl/maps/YOUR_MAP_LINK" target="_blank" style="color: white; text-decoration: none;">New Cairo, Egypt</a>
          </p>
          <p><i class="fas fa-envelope"></i> 
            <a href="mailto:newcairosch@stemnewcairo.moe.edu.eg" style="color: white; text-decoration: none;">newcairosch@stemnewcairo.moe.edu.eg</a>
          </p>
                          <p>
        <i class="fab fa-facebook"></i>
            <a href="https://www.facebook.com/p/New-Cairo-STEM-School-61566966401314/"
               target="_blank"
               style="color: white; text-decoration: none;">
               Facebook
            </a>
        </p>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="footer-credits">
        <p>&copy; 2025 New Cairo STEM School. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>

<script>
// ================= Configuration =================
const SHEET_CONFIG = {
  sheetId: "1BauNTIeSgsfNfJp6LStdoX3UEZ-BQNYExNDBapr3Kzs",
  range: "Staff",
  apiKey: "AIzaSyCAH2AEtxsa6t4GwoDVjCDIHUq_hhbNbjo"
};

// ================= Utility Functions =================
function randomDelay() {
  return Math.floor(Math.random() * 400) + 100;
}

function sanitizeId(text) {
  return text.replace(/\s+/g, "-").toLowerCase();
}

// ================= Data Fetching =================
async function fetchStaffData() {
  try {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_CONFIG.sheetId}/values/${SHEET_CONFIG.range}?key=${SHEET_CONFIG.apiKey}`;
    const response = await fetch(url);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    const [headers, ...rows] = data.values;

    return rows.map(row => {
      const staff = {};
      headers.forEach((header, index) => {
        staff[header] = row[index] || "";
      });
      return staff;
    });
  } catch (error) {
    console.error("Error fetching staff data:", error);
    return [];
  }
}

// ================= Card Management =================
let activeCard = null;

function closeActiveCard() {
  if (activeCard) {
    const card = activeCard.querySelector('.staff-card');
    const expandedInfo = activeCard.querySelector('.staff-expanded-info');
    
    card.classList.remove('active');
    expandedInfo.classList.remove('active');
    activeCard.classList.remove('active');
    
    activeCard = null;
  }
}

function handleCardClick(event, memberElement) {
  event.stopPropagation();
  
  const card = memberElement.querySelector('.staff-card');
  const expandedInfo = memberElement.querySelector('.staff-expanded-info');
  
  // If clicking the same card, close it
  if (activeCard === memberElement) {
    closeActiveCard();
    return;
  }
  
  // Close any currently active card
  closeActiveCard();
  
  // Open the clicked card
  card.classList.add('active');
  expandedInfo.classList.add('active');
  memberElement.classList.add('active');
  activeCard = memberElement;
}

// ================= HTML Generation =================
function createStaffCard(member) {
  return `
    <div class="staff-member">
      <div class="staff-card" onclick="handleCardClick(event, this.closest('.staff-member'))">
        <div class="staff-image-container">
          <img src="${member['img url'] || 'images/placeholder.png'}" 
               alt="${member.Name}" 
               class="staff-image">
          <div class="staff-overlay">
            <h3 class="staff-name">${member.Name}</h3>
            <p class="staff-title">${member.Title}</p>
          </div>
        </div>
      </div>
      <div class="staff-expanded-info">
        <div class="staff-info-content">
          <button class="close-btn" onclick="closeActiveCard()">Ã—</button>
          <div class="staff-details">
            <h4>${member.Name}</h4>
            <p class="position">${member.Title}</p>
            <p class="subject">${member.Subject}</p>
            <div class="info-text">
              ${member.Info || "No additional information available."}
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
}

function createSubjectSection(subject, members) {
  const sectionId = sanitizeId(subject);
  const memberCards = members.map(createStaffCard).join('');
  
  return `
    <div class="subject-section" id="section-${sectionId}">
      <div class="subject-header">
        <h2 class="subject-title">${subject}</h2>
      </div>
      <div class="staff-grid">
        ${memberCards}
      </div>
    </div>
  `;
}

// ================= Main Generation Function =================
async function generateStaffSections() {
  const container = document.getElementById('staff-container');
  const staffData = await fetchStaffData();
  
  if (!staffData.length) {
    container.innerHTML = '<p class="error-message">Unable to load staff data. Please try again later.</p>';
    return;
  }
  
  // Group staff by subject
  const subjectGroups = {};
  staffData.forEach(member => {
    const subject = member.Subject || 'Other';
    if (!subjectGroups[subject]) {
      subjectGroups[subject] = [];
    }
    subjectGroups[subject].push(member);
  });
  
  // Generate HTML for each subject
  let html = '';
  for (const [subject, members] of Object.entries(subjectGroups)) {
    html += createSubjectSection(subject, members);
  }
  
  container.innerHTML = html;
}

// ================= Event Listeners =================
document.addEventListener('DOMContentLoaded', () => {
  generateStaffSections();
  
  // Close expanded card when clicking outside
  document.addEventListener('click', (event) => {
    if (!event.target.closest('.staff-member') && activeCard) {
      closeActiveCard();
    }
  });
  
  // Handle escape key
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && activeCard) {
      closeActiveCard();
    }
  });
});

// ================= Make functions globally available =================
window.handleCardClick = handleCardClick;
window.closeActiveCard = closeActiveCard;

// ================= Auto-scroll Function =================


function handleCardClick(event, memberElement) {
  event.stopPropagation();
  
  const card = memberElement.querySelector('.staff-card');
  const expandedInfo = memberElement.querySelector('.staff-expanded-info');
  
  // If clicking the same card, close it
  if (activeCard === memberElement) {
    closeActiveCard();
    return;
  }
  
  // Close any currently active card
  closeActiveCard();
  
  // Open the clicked card
  card.classList.add('active');
  expandedInfo.classList.add('active');
  memberElement.classList.add('active');
  activeCard = memberElement;
  
  // Scroll to the SPECIFIC card that was clicked
  scrollToCard(memberElement);
}

// ================= Auto-scroll Function =================
function scrollToCard(memberElement) {
  // Wait for the expanded info to finish its animation (0.4s transition)
  setTimeout(() => {
    // Scroll directly to the clicked card's position
    memberElement.scrollIntoView({
      behavior: 'smooth',
      block: 'center',
      inline: 'nearest'
    });
  }, 50); // Wait for expansion animation to complete
}
</script>

<script src="script.js"></script>
</body>
</html>
